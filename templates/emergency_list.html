{% extends 'base.html' %}

{% block title %}Emergency Alerts - BloodBridge{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-800 flex items-center">
                <span class="text-4xl mr-3 animate-pulse">üö®</span> Emergency Alerts
            </h1>
            <p class="text-gray-600 mt-1">Critical blood requests requiring immediate attention</p>
        </div>
        <a href="{{ url_for('sos_emergency') }}" class="mt-4 md:mt-0 bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition inline-flex items-center shadow-lg">
            <span class="text-xl mr-2">üÜò</span> Create Emergency Alert
        </a>
    </div>
    
    <!-- Alerts -->
    <div class="space-y-6">
        {% for alert in alerts %}
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border-l-4 
            {% if alert.can_help %}border-green-500 ring-2 ring-green-200{% else %}border-gray-300{% endif %}">
            
            <!-- Alert Header -->
            <div class="bg-gradient-to-r from-red-600 to-red-700 px-6 py-4">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                    <div class="flex items-center text-white">
                        <span class="text-3xl mr-3 animate-pulse">üö®</span>
                        <div>
                            <span class="font-bold text-xl">EMERGENCY: {{ alert.blood_group }} Blood Needed</span>
                            <p class="text-red-100 text-sm">Posted by {{ alert.requester_name }}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 mt-3 md:mt-0">
                        {% if alert.can_help %}
                        <span class="bg-green-500 text-white px-4 py-2 rounded-full text-sm font-bold animate-pulse shadow-lg">
                            ‚úì You Can Help!
                        </span>
                        {% endif %}
                        <span class="bg-white/20 text-white px-3 py-1 rounded-full text-sm">
                            {{ alert.responder_count }} Responders
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Alert Body -->
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-xs text-gray-500 mb-1 uppercase tracking-wide">Hospital</p>
                        <p class="font-semibold text-gray-800">{{ alert.hospital }}</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-xs text-gray-500 mb-1 uppercase tracking-wide">Location</p>
                        <p class="font-semibold text-gray-800">{{ alert.location }}</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-xs text-gray-500 mb-1 uppercase tracking-wide">Blood Type</p>
                        <span class="inline-block bg-red-600 text-white px-3 py-1 rounded-full font-bold text-lg">
                            {{ alert.blood_group }}
                        </span>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 border-2 border-green-200">
                        <p class="text-xs text-green-600 mb-1 uppercase tracking-wide font-semibold">üìû Emergency Contact</p>
                        <p class="font-bold text-green-800 text-lg">{{ alert.contact_phone if alert.contact_phone else 'N/A' }}</p>
                    </div>
                </div>
                
                {% if alert.details %}
                <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <p class="text-sm text-yellow-800">
                        <strong>Details:</strong> {{ alert.details }}
                    </p>
                </div>
                {% endif %}
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4">
                    {% if alert.can_help and session.get('user_id') not in alert.responders and alert.requester_id != session.get('user_id') %}
                    
                    <!-- Respond Button -->
                    <form method="POST" action="{{ url_for('respond_to_emergency', alert_id=alert.alert_id) }}" class="flex-1">
                        <button type="submit" class="w-full bg-green-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-green-700 transition flex items-center justify-center shadow-lg">
                            <span class="text-2xl mr-2">ü¶∏</span>
                            I Will Help - Respond Now
                        </button>
                    </form>
                    
                    <!-- Call Button -->
                    {% if alert.contact_phone %}
                    <a href="tel:{{ alert.contact_phone }}" class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 transition flex items-center justify-center shadow-lg">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                        </svg>
                        Call Now
                    </a>
                    {% endif %}
                    
                    {% elif session.get('user_id') in alert.responders %}
                    <div class="flex-1 bg-green-100 text-green-800 py-4 rounded-xl font-bold text-lg text-center flex items-center justify-center">
                        <span class="text-2xl mr-2">‚úì</span>
                        You've Responded - Help is on the way!
                    </div>
                    {% if alert.contact_phone %}
                    <a href="tel:{{ alert.contact_phone }}" class="bg-blue-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-blue-700 transition flex items-center justify-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                        </svg>
                        Call
                    </a>
                    {% endif %}
                    
                    {% elif alert.requester_id == session.get('user_id') %}
                    <div class="flex-1 bg-blue-100 text-blue-800 py-4 rounded-xl font-bold text-lg text-center">
                        üìã Your Emergency Alert
                        {% if alert.responder_count > 0 %}
                        <span class="ml-2 bg-green-500 text-white px-3 py-1 rounded-full text-sm">
                            {{ alert.responder_count }} responding!
                        </span>
                        {% endif %}
                    </div>
                    
                    {% else %}
                    <div class="flex-1 bg-gray-100 text-gray-600 py-4 rounded-xl font-semibold text-center">
                        ‚ö†Ô∏è Your blood type ({{ session.get('blood_group') }}) is not compatible with {{ alert.blood_group }}
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Footer with timestamp -->
            <div class="px-6 py-3 bg-gray-50 border-t text-sm text-gray-500">
                Posted: {{ alert.created_at[:16].replace('T', ' ') if alert.created_at else 'Just now' }}
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if not alerts %}
    <div class="bg-white rounded-xl shadow-md p-12 text-center">
        <div class="text-6xl mb-4">‚úÖ</div>
        <h3 class="text-xl font-semibold text-gray-800 mb-2">No Active Emergencies</h3>
        <p class="text-gray-500 mb-6">There are currently no emergency blood alerts. This is great news!</p>
        <a href="{{ url_for('dashboard') }}" class="inline-block bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition">
            Back to Dashboard
        </a>
    </div>
    {% endif %}
    
    <!-- Emergency Hotline -->
    <div class="mt-8 bg-gradient-to-r from-red-600 to-red-700 rounded-xl p-6 text-white text-center">
        <p class="text-lg font-semibold mb-2">üè• 24/7 Blood Bank Helpline</p>
        <a href="tel:1800-BLOOD" class="text-3xl font-bold hover:underline">1800-BLOOD-HELP</a>
        <p class="text-red-200 text-sm mt-2">For life-threatening emergencies, also call ambulance services</p>
    </div>
</div>
{% endblock %}
